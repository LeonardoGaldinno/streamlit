name: Deploy to Google Cloud

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Google Cloud SDK
        run: |
          echo "${{ secrets.GCP_SA_KEY }}" | tr -d '\r' > $HOME/gcloud-service-key.json
          
      - name: Display JSON file contents (for debugging)
        run: |
          cat $HOME/gcloud-service-key.json
          echo "End of JSON file contents"

      - name: Authenticate with Google Cloud
        run: gcloud auth activate-service-account --key-file=$HOME/gcloud-service-key.json

      - name: Set project
        run: gcloud config set project neural-journey-377617

      - name: Deploy application
        run: |
          # Your deployment commands here, e.g.:
          # gcloud app deploy app.yaml --quiet
          echo "Deploying application..."

      - name: Cleanup
        run: rm $HOME/gcloud-service-key.json
