name: Deploy to Google Cloud

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Google Cloud SDK
        run: |
          echo "${{ secrets.GCP_SA_KEY }}" > $HOME/gcloud-service-key.json
          
      - name: Validate JSON format
        run: |
          if ! jq empty $HOME/gcloud-service-key.json; then
            echo "Invalid JSON format."
            exit 1
          fi
          
      - name: Authenticate with Google Cloud
        run: gcloud auth activate-service-account --key-file=$HOME/gcloud-service-key.json

      - name: Set Google Cloud project
        run: gcloud config set project neural-journey-377617

      - name: Deploy application
        run: |
          # Your deployment commands here
          echo "Deploying application..."

      - name: Cleanup
        run: rm $HOME/gcloud-service-key.json
